name: Smart Water Reminder

on:
    push:
        branches:
            - develop
    schedule:
        # å·¥ä½œæ—¥ 9:00-18:00 æ¯å°æ—¶æ‰§è¡Œï¼ˆUTCæ—¶é—´ï¼Œå¯¹åº”åŒ—äº¬æ—¶é—´ 17:00-02:00ï¼Œéœ€è¦è°ƒæ•´ï¼‰
        # é’ˆå¯¹åŒ—äº¬æ—¶é—´ 9:00-18:00 çš„cronè¡¨è¾¾å¼ï¼š
        - cron: '0 1,2,3,4,5,6,7,8,9,10 * * 1-5' # UTCæ—¶é—´ 1:00-10:00 = åŒ—äº¬æ—¶é—´ 9:00-18:00
    workflow_dispatch:

env:
    TZ: Asia/Shanghai

jobs:
    water-reminder:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@v4

            - name: Send reminder to WeChat
              run: |
                  # è·å–å½“å‰å°æ—¶ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
                  HOUR=$(date -d "+8 hours" +%H)

                  # æ ¹æ®ä¸åŒæ—¶æ®µç”Ÿæˆä¸åŒçš„æé†’æ¶ˆæ¯
                  case $HOUR in
                    "09") MESSAGE="ğŸŒ **æ—©å®‰å–æ°´æ—¶é—´ï¼**\n> å¼€å¯æ–°çš„ä¸€å¤©ï¼Œä»ä¸€æ¯æ¸©æ°´å¼€å§‹ï½" ;;
                    "12") MESSAGE="ğŸ± **åˆé—´å–æ°´æ—¶é—´ï¼**\n> åˆé¤ååŠå°æ—¶ï¼Œå–æ¯æ°´åŠ©æ¶ˆåŒ–ï½" ;;
                    "17") MESSAGE="ğŸŒ‡ **å‚æ™šå–æ°´æ—¶é—´ï¼**\n> è¡¥å……æ°´åˆ†ï¼Œä¸ºä¸‹ç­å‰çš„å†²åˆºåŠ æ²¹ï¼" ;;
                    *) MESSAGE="ğŸ’§ **å–æ°´æ—¶é—´åˆ°ï¼**\n> å·¥ä½œè¾›è‹¦äº†ï¼Œè®°å¾—è¡¥å……æ°´åˆ†å“¦ï½" ;;
                  esac

                  # å‘é€è¯·æ±‚åˆ°ä¼ä¸šå¾®ä¿¡
                  curl -X POST \
                    -H "Content-Type: application/json" \
                    -d "{
                      \"msgtype\": \"markdown\",
                      \"markdown\": {
                        \"content\": \"$MESSAGE\n\nâ° æé†’æ—¶é—´: $(date -d '+8 hours' '+%H:%M')\nğŸ’§ ä»Šæ—¥å°ç›®æ ‡: 8æ¯æ°´å·²å®Œæˆ $(( (10#$HOUR - 8) ))/8æ¯\"
                      }
                    }" \
                    ${{ secrets.WECHAT_WEBHOOK_URL }}
